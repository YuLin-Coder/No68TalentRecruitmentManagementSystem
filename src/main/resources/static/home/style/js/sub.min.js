$(function(){var a=!1;navigator.userAgent.indexOf("MSIE 7.0")>0&&(a=!0),$(".s_radio li").click(function(){var b,c;$(this).addClass("current").append("<em></em>").siblings().removeClass("current").find("em").remove(),b=$(this).attr("title"),$(this).parents(".s_radio").siblings("input").val(b),c=$(this).parents(".s_radio").siblings("input").attr("id"),$("#subForm").validate().element("#"+c)}),$(".s_radio_sp li").click(function(){if($(this).hasClass("current"))$(this).removeClass("current").find("em").remove(),$(this).parents(".s_radio_sp").siblings("input").val("");else{$(this).addClass("current").append("<em></em>").siblings().removeClass("current").find("em").remove();var b=$(this).attr("title");$(this).parents(".s_radio_sp").siblings("input").val(b)}}),$(".s_tips li").hover(function(){$(this).children("span").fadeIn(200)},function(){$(this).children("span").fadeOut(200)}),$(document).click(function(){$("#box_industry").hide(),$("#sub_box_job").hide(),$("#box_salary").hide()}),$("#select_industry").bind("click",function(a){a.stopPropagation(),$("#sub_box_job").hide(),$("#box_salary").hide(),$("#box_industry").show()}),$("#box_industry").on("click","ul li",function(a){a.stopPropagation();var b=$(this).text();$(this).hasClass("current")?($(this).removeClass("current"),$("#select_industry").val("请选择行业领域"),$("#select_industry_hidden").val("")):($(this).addClass("current").siblings().removeClass("current"),$("#select_industry").val(b),$("#select_industry_hidden").val(b),$("#box_industry").hide())}),$("#sub_box_job").on("mouseenter",".job_main li",function(){$(this).children("ul").show(),console.log(1);var b="";$("#sub_box_job .job_main").each(function(){$(this).children("li").each(function(){b=$("#sub_box_job").height()-($(this).offset().top-$(this).parents("#sub_box_job").offset().top+38),b<$(this).children(".job_sub").height()&&(a?$(this).children(".job_sub").css({marginTop:"-30"-$(this).children(".job_sub").height()+"px"}):$(this).children(".job_sub").css({marginTop:"-50"-$(this).children(".job_sub").height()+"px"}))})})}),$("#sub_box_job").on("mouseleave",".job_main li",function(){$(this).children("ul").hide()}),$("#select_job").bind("click",function(a){a.stopPropagation(),$("#box_industry").hide(),$("#box_salary").hide(),$("#sub_box_job").show()}),$("#sub_box_job").on("click",".job_sub li",function(a){a.stopPropagation();var b=$(this).text();$("#select_job").val(b),$("#select_job_hidden").val(b),$(this).parents(".job_sub").hide(),$("#sub_box_job").hide(),$("#subForm").validate().element("#select_job_hidden")}),$("#sub_box_job dl").each(function(){var b=$(this);b.find(".job_main").children("li").each(function(b){1==b%3?a?$(this).children(".job_sub").css({marginLeft:"-234px"}):$(this).children(".job_sub").css({marginLeft:"-164px"}):2==b%3&&(a?$(this).children(".job_sub").css({marginLeft:"-389px"}):$(this).children(".job_sub").css({marginLeft:"-320px"}))})}),$("#select_salary").bind("click",function(a){a.stopPropagation(),$("#sub_box_job").hide(),$("#box_industry").hide(),$("#box_salary").show()}),$("#box_salary").on("click","ul li",function(a){a.stopPropagation();var b=$(this).text();$(this).hasClass("current")?($(this).removeClass("current"),$("#select_salary").val("请选择月薪范围"),$("#select_salary_hidden").val("")):($(this).addClass("current").siblings().removeClass("current"),$("#select_salary").val(b),$("#select_salary_hidden").val(b),$("#box_salary").hide())}),$("#box_industry,#sub_box_job,#box_salary").bind("click",function(a){a.stopPropagation()}),$("#subEmail").blur(function(){var a,b,c,d;$("#commonError").hide(),a=$("#userid").val(),b=$("#orderId").val(),c=$(this).val(),d=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,d.test(c)&&$.ajax({type:"POST",url:ctx+"/s/check.json",dataType:"json",data:{email:c,userId:a,orderid:b}}).done(function(a){$("#emailError").html(a.msg).show()})}),$("#subForm").validate({onkeyup:!1,focusCleanup:!0,rules:{city:{required:!0},positionName:{required:!0},sendMailPer:{required:!0},email:{required:!0,email:!0},financeStage:{required:!1},industryField:{required:!1},salary:{required:!1}},messages:{city:{required:"请选择工作地点"},positionName:{required:"请选择职位名称"},sendMailPer:{required:"请选择发送周期"},email:{required:"请输入接收邮箱",email:"请输入有效的接收邮箱地址"}},errorPlacement:function(a,b){"hidden"==b.attr("type")?a.insertAfter($(b).parent()):a.insertAfter(b)},invalidHandler:function(a,b){if(b.numberOfInvalids()){var c=$(b.errorList[0].element).offset().top;"positionName"==b.errorList[0].element.name?c=450:"sendMailPer"==b.errorList[0].element.name?c=150:"city"==b.errorList[0].element.name&&(c=600),$("html, body").animate({scrollTop:c},400)}},submitHandler:function(a){var b,c,d,e,f,g,h,i,j;$(a).find(":submit").val("正在保存...").attr("disabled",!0),b=$("#orderId").val(),c=$("#select_day_hidden").val(),d=$("#subEmail").val(),e=$("#select_city_hidden").val(),f=$("#select_stage_hidden").val(),g=$("#select_industry_hidden").val(),h=$("#select_job_hidden").val(),i=$("#select_salary_hidden").val(),j=$("#resubmitToken").val(),$.ajax({url:ctx+"/s/subscribe.json",type:"POST",data:{id:b,sendMailPer:c,email:d,city:e,financeStage:f,industryField:g,positionName:h,salary:i,resubmitToken:j},dataType:"json"}).done(function(b){$("#resubmitToken").val(b.resubmitToken),b.success?0==b.code?($("#subscribeSuccessLogined p a").text(d),$.colorbox({inline:!0,href:"#subscribeSuccessLogined",title:"职位订阅"})):2==b.code?window.location.href=b.content.activeUrl:3==b.code&&($("#subscribeSuccessLogin p a").text(d),$.colorbox({inline:!0,href:"#subscribeSuccessLogin",title:"职位订阅"})):(b.content.commonError&&($("#emailError").html(b.content.commonError).show(),$("html, body").animate({scrollTop:0},400)),b.content.cityError&&$("#cityError").html(b.content.cityError).show(),b.content.stageError&&$("#stageError").html(b.content.stageError).show()),$(a).find(":submit").val("保 存").attr("disabled",!1)})}}),$("#subForm .btn_cancel").bind("click",function(){$("#subForm .s_radio li,#subForm .s_radio_sp li").each(function(){$(this).removeClass("current").find("em").remove()}),$("#select_day_hidden").val(""),$("#select_city_hidden").val(""),$("#select_stage_hidden").val(""),$("#subEmail").val(""),$("#select_industry_hidden").val(""),$("#select_industry").val("请选择行业领域"),$("#select_job_hidden").val(""),$("#select_job").val("请选择职位名称"),$("#select_salary_hidden").val(""),$("#select_salary").val("请选择月薪范围"),$("#box_industry ul li,#box_salary ul li").removeClass("current"),1==$("#orderCount").val()&&($("#subForm").hide(),$(".selected").show())}),$(".selected .sedit").bind("click",function(){var a=$(this).attr("rel"),b=$("#oi"+a).val(),c=$("#pn"+a).val()?$("#pn"+a).val():"请选择职位名称",d=$("#ci"+a).val(),e=$("#inf"+a).val()?$("#inf"+a).val():"请选择行业领域",f=$("#fs"+a).val(),g=$("#sa"+a).val()?$("#sa"+a).val():"请选择月薪范围",h=$("#smp"+a).val(),i=$("#em"+a).val();$("#subForm #orderId").val(b),$("#subForm #select_city_hidden").val(d),$("#subForm #select_city_hidden").siblings("ul").children("li").each(function(){$(this).attr("title")==d&&$(this).trigger("click")}),$("#subForm #subEmail").val(i),$("#subForm #select_stage_hidden").val(f),$("#subForm #select_stage_hidden").siblings("ul").children("li").each(function(){$(this).attr("title")==f&&$(this).trigger("click")}),$("#subForm #select_industry").val(e),"请选择行业领域"!=e&&$("#subForm #select_industry_hidden").val(e),$("#box_industry li").each(function(){$(this).text()==e&&$(this).addClass("current")}),"请选择职位名称"!=c&&$("#subForm #select_job_hidden").val(c),$("#subForm #select_job").val(c),$("#subForm #select_salary").val(g),"请选择月薪范围"!=g&&$("#subForm #select_salary_hidden").val(g),$("#box_salary li").each(function(){$(this).text()==g&&$(this).addClass("current")}),$("#subForm #select_day_hidden").val(h),$("#subForm #select_day_hidden").siblings("ul").children("li").each(function(){$(this).attr("title")==h&&$(this).trigger("click")}),$("#subForm #email").val(i),$(this).parents(".selected").hide(),$("#subForm").show()}),$(".selected .sclose").bind("click",function(){var a,b;confirm("确定要删除这个订阅器吗？")&&(a=$(this).attr("rel"),b=$("#oi"+a).val(),$.ajax({type:"POST",url:ctx+"/s/cancel.json",data:{id:b},dataType:"json"}).done(function(a){a.success?top.location.href=ctx+"/s/subscribe.html":alert(a.msg)}))}),$("#subscribeSuccessUser .btn_s").bind("click",function(){return $.colorbox({inline:!0,href:"#loginPop",title:"登录"}),!1}),$("#resendSub").click(function(){var a=$(".emailus a").text(),b=$("#subId").val();$.ajax({type:"POST",data:{code:b,email:a},url:ctx+"/s/reresendActiveOrder"}).done(function(a){a.success?$.colorbox({inline:!0,href:"#resend_success",title:"验证邮件发送成功"}):alert(a.msg)})}),$("#subForm").on("click","a.email_login",function(){$.colorbox({inline:!0,href:"#loginPop",title:"登录"})}),$("#subForm").on("click","a.email_register",function(){$("#subscribeSuccessRegister em").text($("#subEmail").val()),$("#subscribeSuccessRegister p a").text($("#subEmail").val()),$.colorbox({inline:!0,href:"#subscribeSuccessRegister",title:"注册"})}),$("#registerPopForm").validate({rules:{password:{required:!0,rangelength:[6,18]},checkbox:{required:!0}},messages:{password:{required:"请输入密码",rangelength:"请输入6-16位密码，字母区分大小写"},checkbox:{required:"请接受拉勾用户协议"}},errorPlacement:function(a,b){"checkbox"==b.attr("type")?a.insertAfter($(b).parent()).css("clear","left"):a.insertAfter(b)},submitHandler:function(a){var b=$("em",a).text(),c=$("#psw",a).val(),d=$("#resubmitToken").val();$(a).find(":submit").attr("disabled",!0),$.ajax({type:"POST",data:{email:b,password:c,isAcitive:1,resubmitToken:d},url:ctx+"/user/register.json",dataType:"json"}).done(function(b){$("#resubmitToken").val(b.resubmitToken),b.success?top.location.href=ctx+"/s/subscribe.html":$("#beError_register",a).html(b.msg).show(),$(a).find(":submit").attr("disabled",!1)})}}),$("#confirmCancel").click(function(){var a=$("#em1").val(),b=$("#oi1").val();$.ajax({type:"POST",data:{email:a,id:b},url:ctx+"/s/unsub.json"}).done(function(a){a.success?top.location.href=ctx+"/s/subscribe.html":alert(a.msg)})})});